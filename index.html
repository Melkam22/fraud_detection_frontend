<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fraud Detection ‚Äì AI Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <style>
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont;
    }

    .card-container {
      position: relative;
      border-radius: 24px;
      background: #ffffff;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.35);
      padding: 2.5rem;
    }

    .card-container::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 26px;
      background: linear-gradient(135deg, #38bdf8, #22c55e);
      z-index: -1;
      opacity: 0.35;
    }

    .hero-title {
      font-weight: 800;
      font-size: 2.1rem;
      text-align: center;
      color: #0f172a;
    }

    .hero-subtitle {
      text-align: center;
      color: #475569;
      margin-bottom: 1.8rem;
    }

    label {
      font-weight: 600;
      color: #334155;
    }

    input,
    select {
      border-radius: 14px !important;
      padding: 10px 14px;
    }

    .btn-primary {
      border-radius: 16px;
      font-weight: 700;
      font-size: 1.1rem;
      background: linear-gradient(135deg, #22c55e, #14b8a6);
      border: none;
      box-shadow: 0 10px 30px rgba(34, 197, 94, 0.45);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 36px rgba(34, 197, 94, 0.55);
    }

    .result {
      margin-top: 24px;
      padding: 18px;
      border-radius: 16px;
      font-size: 1.1rem;
      font-weight: 700;
      text-align: center;
      display: none;
    }

    .fraud {
      background: #fee2e2;
      color: #991b1b;
      border: 2px solid #dc2626;
    }

    .safe {
      background: #dcfce7;
      color: #065f46;
      border: 2px solid #22c55e;
    }

    footer {
      margin-top: 2rem;
      color: #cbd5f5;
      text-align: center;
      font-size: 0.85rem;
    }
  </style>
</head>

<body>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">

      <div class="card-container">

        <h1 class="hero-title">üí≥ Fraud Detection</h1>
        <p class="hero-subtitle">
          AI-powered transaction risk analysis in real time
        </p>

        <form id="fraudForm">

          <div class="mb-3">
            <label>Transaction Time</label>
            <input type="datetime-local" class="form-control" id="time" required />
          </div>

          <div class="mb-3">
            <label>Category</label>
            <select class="form-select" id="category">
              <option>Food</option>
              <option>Travel</option>
              <option>Shopping</option>
              <option>Other</option>
            </select>
          </div>

          <div class="mb-3">
            <label>Amount</label>
            <input type="number" class="form-control" id="amount" value="100.0" required />
          </div>

          <div class="mb-3">
            <label>Gender</label>
            <select class="form-select" id="gender">
              <option value="M">Male</option>
              <option value="F">Female</option>
              <option value="O">Other</option>
            </select>
          </div>

          <div class="row mb-3">
            <div class="col">
              <label>Lat (Cardholder)</label>
              <input type="number" class="form-control" id="lat" value="0" />
            </div>
            <div class="col">
              <label>Long (Cardholder)</label>
              <input type="number" class="form-control" id="long" value="0" />
            </div>
          </div>

          <div class="mb-3">
            <label>Date of Birth</label>
            <input type="date" class="form-control" id="dob" required />
          </div>

          <div class="row mb-4">
            <div class="col">
              <label>Lat (Merchant)</label>
              <input type="number" class="form-control" id="mlat" value="0" />
            </div>
            <div class="col">
              <label>Long (Merchant)</label>
              <input type="number" class="form-control" id="mlong" value="0" />
            </div>
          </div>

          <button class="btn btn-primary w-100" type="submit">
            üîç Predict Fraud
          </button>
        </form>

        <div id="result" class="result"></div>

        <!-- ‚úÖ QR CODE -->
        <div class="text-center mt-4">
          <p class="fw-semibold text-secondary">üì± Open on mobile</p>
          <img
            src="https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=https://melkam22.github.io/fraud_detection_frontend/"
            class="rounded shadow"
            alt="QR code"
          />
        </div>

      </div>

      <footer>
        ¬© 2025 AI Fraud Detection ‚Ä¢ Powered by FastAPI & Machine Learning
      </footer>

    </div>
  </div>
</div>

<script>
  // ‚úÖ Change only this if switching local/cloud API
  // const API_URL = "http://127.0.0.1:8000/predict_new";
  const API_URL = "https://fraud-app-546443544540.europe-west1.run.app/predict_new";

  document.getElementById("fraudForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const resultBox = document.getElementById("result");
    resultBox.style.display = "none";

    const params = new URLSearchParams({
      trans_date_trans_time: document.getElementById("time").value.replace("T", " "),
      category: document.getElementById("category").value,
      amt: document.getElementById("amount").value,
      gender: document.getElementById("gender").value,
      lat: document.getElementById("lat").value,
      long: document.getElementById("long").value,
      dob: document.getElementById("dob").value,
      merch_lat: document.getElementById("mlat").value,
      merch_long: document.getElementById("mlong").value,
    });

    try {
      const response = await fetch(`${API_URL}?${params}`);
      const data = await response.json();

      const prob = (data.fraud_probability * 100).toFixed(2);

      if (data.fraud) {
        resultBox.className = "result fraud";
        resultBox.innerHTML = `üö® FRAUD DETECTED<br>Probability: ${prob}%`;
      } else {
        resultBox.className = "result safe";
        resultBox.innerHTML = `‚úÖ NOT FRAUD<br>Probability: ${prob}%`;
      }

      resultBox.style.display = "block";

    } catch (err) {
      resultBox.className = "result fraud";
      resultBox.innerHTML = "Cannot reach API";
      resultBox.style.display = "block";
    }
  });
</script>

</body>
</html>
